## 新增需求

### 需求：指数退避重试

代理服务应实现带抖动的指数退避来重试失败请求。

#### 场景：429 错误后首次重试
- **当** 请求返回 HTTP 429（请求过多）
- **则** 系统等待 `initialDelayMs`（默认 1000 毫秒）加上随机抖动
- **并且** 使用不同账号重试请求

#### 场景：后续重试延迟递增
- **当** 多个连续请求因 429 失败
- **则** 每次尝试延迟翻倍（指数增长）
- **并且** 延迟上限为 `maxDelayMs`（默认 30000 毫秒）

#### 场景：超过最大重试次数
- **当** 超过最大重试次数（默认 5 次）
- **则** 系统向客户端返回错误响应
- **并且** 包含关于速率限制的有用提示信息

---

### 需求：重试配置

代理服务应允许用户配置重试行为。

#### 场景：用户配置重试设置
- **当** 用户导航到代理设置
- **则** 可以配置：
  - 最大重试次数（1-10，默认 5）
  - 初始延迟（100-5000 毫秒，默认 1000 毫秒）
  - 最大延迟（5000-60000 毫秒，默认 30000 毫秒）

#### 场景：配置跨重启持久化
- **当** 用户保存重试配置
- **并且** 重启应用
- **则** 从存储中恢复配置

---

### 需求：请求速率追踪

代理服务应追踪每个账号的每分钟请求数（RPM）。

#### 场景：RPM 计数器递增
- **当** 请求通过某账号成功发送
- **则** 该账号的 RPM 计数器增加 1

#### 场景：RPM 计数器使用滑动窗口
- **当** 某请求发出后已过 60 秒
- **则** 该请求不再计入 RPM 总数

#### 场景：RPM 数据暴露给前端
- **当** 前端查询配额指标
- **则** 响应包含每个账号的当前 RPM

---

## 修改需求

### 需求：请求的账号选择

代理服务应根据可用性和速率限制状态选择账号。

#### 场景：选择健康账号
- **当** 有多个账号可用
- **并且** 至少有一个账号未被限流
- **则** 系统使用轮询方式选择健康账号

#### 场景：跳过被限流账号
- **当** 某账号被标记为限流
- **则** 该账号在 5 分钟（冷却期）内被排除在选择之外

#### 场景：预请求检查防止触发限流
- **当** 某账号的本地 RPM 超过估算限制的 80%
- **则** 跳过该账号，选择使用较少的账号
